webpackJsonp([3],{Kw9t:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={components:{},data:function(){return{dialogFormVisible:!1,isEdit:!1,formValue:{id:"",remark:"",name:"",roleType:"",roleCode:"",isPrivate:"n"},rules:{name:[{required:!0,message:"请输入角色名",trigger:"blur"}],roleType:[{required:!0,message:"请选择角色类型",trigger:"blur"}],remark:[{required:!0,message:"请输入备注说明",trigger:"blur"}]},securityId:"",checkedAll:!1,checkboxGroupValue:[],loading:!1,userPriv:[]}},created:function(){var e=this;e.privAccessMap={},e.checkBoxAllValues=[];window.location.search;if(window.self!==window.top)if(e.userPriv=window.parent.__USER_MENU_TREE__,e.userPriv){var t={},l=[],r={};e.userPriv.forEach(function(a){a.children.forEach(function(a){!function a(o){if(o.children&&o.children.length>0)o.children.forEach(function(e){a(e)});else{if(o.privs&&o.privs.length>0){for(var n=0;n<o.privs.length;n++){var i=o.privs[n];if(t[i.code]){e.$message({type:"error",message:"按钮权限重复定义,code: "+i});break}l.push(i.code),t[i.code]=i.access?i.access:[]}r[o.path]=o.privs.map(function(e){return e.code})}o.path&&l.push(o.path)}}(a)})}),e.privAccessMap=t,e.checkBoxAllValues=l,e.pathPrivCodeMap=r}else console.log("window.parent.__USER_MENU_TREE__ 对象获取为空");else console.log("此页面必须运行在 iframe 下")},watch:{checkedAll:function(e){this.checkboxGroupValue=e?this.checkBoxAllValues:[]},checkboxGroupValue:function(e,t){var l=this;if(!l.initLoad&&!(0==e.length&&t.length==l.checkBoxAllValues.length||e.length==l.checkBoxAllValues.length&&0==t.length)){var r=t.filter(function(e){return-1!=e.indexOf("/")}),a=e.filter(function(e){return-1!=e.indexOf("/")});if(r.length!=a.length){var o=[],n=[];r.length<a.length?(a.forEach(function(e){r.contains(e)||o.push(e)}),o.forEach(function(e){var t=l.pathPrivCodeMap[e];t&&t.forEach(function(e){l.checkboxGroupValue.contains(e)||l.checkboxGroupValue.push(e)})})):(r.forEach(function(e){a.contains(e)||n.push(e)}),n.forEach(function(e){var t=l.pathPrivCodeMap[e];t&&t.forEach(function(e){for(var t=0;t<l.checkboxGroupValue.length;t++)if(l.checkboxGroupValue[t]==e){l.checkboxGroupValue.splice(t,1);break}})}))}}}},mounted:function(){},methods:{showDialog:function(e){var t=this;t.dialogFormVisible=!0,t.formValue={},t.checkboxGroupValue=[],t.initLoad=!0,e?t.$ajax({url:$portal_context+"/user/RoleRpc/detail.json",data:{securityId:e},success:function(e){var l=[],r=e.data;r.menus&&r.menus.forEach(function(e){t.checkBoxAllValues.contains(e)&&l.push(e)}),r.btnCodes&&r.btnCodes.forEach(function(e){t.checkBoxAllValues.contains(e)&&l.push(e)}),delete r.menus,delete r.btnCodes,delete r.dataUris,t.formValue=r,t.checkboxGroupValue=l,window.setTimeout(function(){t.initLoad=!1},200)}}):t.initLoad=!1},submitForm:function(e){var t=this;t.$refs.role_form_panel.validate(function(e){e&&t.ajaxSubmitForm()})},ajaxSubmitForm:function(e){var t=this;if(!t.saveButtonDisabled){var l=t.checkboxGroupValue.filter(function(e){return-1!=e.indexOf("/")}),r=t.checkboxGroupValue.filter(function(e){return-1==e.indexOf("/")}),a=[];r.forEach(function(e){t.privAccessMap[e]&&t.privAccessMap[e].forEach(function(e){a.contains(e)||a.push(e)})}),t.formValue.menus=l,t.formValue.btnCodes=r,t.formValue.dataUris=a,t.$ajax({url:$portal_context+"/user/RoleRpc/saveUpdate.json",type:"json",data:t.formValue,success:function(e){t.$message({type:"success",message:"操作成功"}),t.dialogFormVisible=!1,t.$emit("afterSubmitSuccess")}})}},handleChange:function(e){}}},a={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-dialog",{attrs:{title:e.formValue.securityId?"编辑角色":"新增角色",visible:e.dialogFormVisible,fullscreen:"","append-to-body":""},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[l("el-form",{ref:"role_form_panel",staticClass:"float_form_panel_div",attrs:{rules:e.rules,model:e.formValue,"label-width":"130px"}},[l("field-title",{staticStyle:{width:"100%"},attrs:{title:"角色基础信息"}}),e._v(" "),l("el-row",[l("el-col",[l("el-form-item",{attrs:{label:"角色名",prop:"name"}},[l("el-input",{model:{value:e.formValue.name,callback:function(t){e.$set(e.formValue,"name",t)},expression:"formValue.name"}})],1)],1)],1),e._v(" "),l("el-row",[l("el-col",{attrs:{span:2}},[l("el-form-item",{attrs:{label:"备注说明",prop:"remark"}},[l("el-input",{model:{value:e.formValue.remark,callback:function(t){e.$set(e.formValue,"remark",t)},expression:"formValue.remark"}})],1)],1)],1),e._v(" "),l("field-title",{staticStyle:{width:"100%"},attrs:{title:"权限配置"}}),e._v(" "),l("el-row",[l("el-col",{staticStyle:{width:"100%"}},[l("el-checkbox-group",{model:{value:e.checkboxGroupValue,callback:function(t){e.checkboxGroupValue=t},expression:"checkboxGroupValue"}},e._l(e.userPriv,function(t,r){return l("div",{staticClass:"div-module"},[l("label",[e._v(e._s(t.module))]),e._v(" "),e._l(t.children,function(t,r){return l("div",{class:"div-level-1"+(0==r?" mt-32":"")},[!t.path||t.children&&0!=t.children.length?l("label",[e._v("\n                "+e._s(t.name)+"\n              ")]):l("el-checkbox",{attrs:{label:t.path}},[e._v("\n                "+e._s(t.name)+"\n              ")]),e._v(" "),e._l(t.children,function(t,r){return l("div",{class:"div-level-2"+(0==r?" mt-32":"")},[!t.path||t.children&&0!=t.children.length?l("label",[e._v("\n                  "+e._s(t.name)+"\n                ")]):l("el-checkbox",{staticStyle:{"line-height":"32px"},attrs:{label:t.path}},[e._v("\n                  "+e._s(t.name)+"\n                ")]),e._v(" "),t.privs&&t.privs.length>0?l("div",{staticClass:"div-level-3 mt-32"},e._l(t.privs,function(t,r){return l("el-checkbox",{key:r,attrs:{label:t.code}},[e._v("\n                    "+e._s(t.label)+"\n                  ")])}),1):e._e(),e._v(" "),e._l(t.children,function(r,a){return t.children&&t.children.length>0?l("div",{class:"div-level-3"+(0==a?" mt-32":"")},[!r.path||r.children&&0!=r.children.length?l("label",[e._v("\n                    "+e._s(r.name)+"\n                  ")]):l("el-checkbox",{attrs:{label:r.path}},[e._v("\n                    "+e._s(r.name)+"\n                  ")]),e._v(" "),r.privs&&r.privs.length>0?l("div",{staticClass:"div-level-4 mt-32"},e._l(r.privs,function(t,r){return l("el-checkbox",{key:r,attrs:{label:t.code}},[e._v("\n                      "+e._s(t.label)+"\n\n                      "),t.description&&""!=t.description?l("el-popover",{attrs:{placement:"top",width:"240",trigger:"hover"}},[e._v("\n                        "+e._s(t.description)+"\n                        "),l("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"})]):e._e()],1)}),1):e._e()],1):e._e()})],2)})],2)})],2)}),0)],1)],1),e._v(" "),l("div",{staticClass:"float_form_panel_btn"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("提 交")]),e._v(" "),l("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),l("el-checkbox",{staticStyle:{"margin-left":"20px"},model:{value:e.checkedAll,callback:function(t){e.checkedAll=t},expression:"checkedAll"}},[e._v("\n        全选\n      ")])],1)],1)],1)},staticRenderFns:[]};var o={components:{RoleForm:l("VU/8")(r,a,!1,function(e){l("V67N")},null,null).exports},data:function(){return{saveButtonDisabled:!1,isShow:!1,rowData:{},searchValue:{},configValueTime:"",queryUrl:"",deleteUrl:"",dialogFormVisible:!1,retryForm:{requestId:"",requestJson:""}}},created:function(){this.queryUrl=$portal_context+"/user/RoleRpc/list.json",this.deleteUrl=$portal_context+"/user/RoleRpc/delete.json"},destroyed:function(){},methods:{showData:function(e){this.rowData=e.row,this.isShow=!0},retryRequest:function(){var e=this;e.saveButtonDisabled=!0,e.$ajax({url:$portal_context+"/document/AutoDocumentRpc/retryRequest.json",data:e.retryForm,success:function(t){e.$message({showClose:!0,message:"操作成功",type:"success"}),e.$refs.gridPanelEl.loadData(),e.dialogFormVisible=!1},afterAjax:function(){e.saveButtonDisabled=!1}})}}},n={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"div-table-view-page"},[l("el-form",{ref:"form",staticClass:"search-panel",staticStyle:{width:"100%"},attrs:{model:e.searchValue,"label-width":"80px"}},[l("el-row",[l("el-col",{staticStyle:{width:"230px"}},[l("el-form-item",{attrs:{label:"关键字"}},[l("el-input",{attrs:{clearable:""},model:{value:e.searchValue.keyword,callback:function(t){e.$set(e.searchValue,"keyword",t)},expression:"searchValue.keyword"}})],1)],1),e._v(" "),l("el-col",{staticStyle:{width:"204px","padding-left":"10px"}},[l("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.$refs.gridPanelEl.loadData(e.searchValue)}}},[e._v("查询")]),e._v(" "),l("el-button",{attrs:{icon:"el-icon-plus"},on:{click:function(t){return e.$refs.roleForm.showDialog()}}},[e._v("新增角色")])],1)],1)],1),e._v(" "),l("ex-table-auto",{ref:"gridPanelEl",staticClass:"el-table-nowwarp",attrs:{url:e.queryUrl,autoFill:"",autoPage:!1,border:""}},[l("el-table-column",{attrs:{type:"index",label:"#",width:"43"}}),e._v(" "),l("el-table-column",{attrs:{label:"角色名",prop:"name","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"备注",prop:"remark","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"创建人",prop:"creator","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"创建时间",prop:"gmtCreate","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"最后修改",prop:"modifier","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"最后修改时间",prop:"gmtModified","min-width":"12"}}),e._v(" "),l("el-table-column",{attrs:{label:"",align:"center",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.$refs.roleForm.showDialog(t.row.securityId)}}},[e._v("编辑")]),e._v(" "),l("ex-button-delete",{attrs:{deleteUrl:e.deleteUrl,rowId:t.row.securityId},on:{afterOperationDone:function(t){return e.$refs.gridPanelEl.loadData()}}})]}}])})],1),e._v(" "),l("role-form",{ref:"roleForm",on:{afterSubmitSuccess:function(t){return e.$refs.gridPanelEl.loadData()}}})],1)},staticRenderFns:[]};var i=l("VU/8")(o,n,!1,function(e){l("wzPI")},null,null);t.default=i.exports},V67N:function(e,t){},wzPI:function(e,t){}});